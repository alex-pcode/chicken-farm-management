# Story 13.1: Refactor EggCounter with Shared Components

## Status
Ready for Review

## Story
**As a** developer working on the EggCounter component,
**I want** to refactor the EggCounter to use the established shared components library,
**so that** the component follows consistent UI patterns, eliminates custom table code, and leverages tested reusable components for better maintainability.

## Acceptance Criteria
1. Replace custom table implementation with DataTable component from `src/components/ui/tables/`
2. Replace custom pagination controls with Pagination component from `src/components/ui/navigation/`
3. Integrate with existing shared components where applicable (StatCard, FormCard already in use)
4. Maintain all existing functionality including animations, form handling, and user experience
5. Remove duplicate table styling code in favor of shared table components
6. Ensure responsive behavior is preserved with shared components
7. Maintain TypeScript type safety throughout the refactoring
8. Preserve Framer Motion animations for table rows and pagination interactions

## Tasks / Subtasks

### Phase 1: Analysis and Planning (AC: 1, 2, 3)
- [x] Analyze current EggCounter table implementation structure
- [x] Review available DataTable component props and configuration options
- [x] Review available Pagination component variants and integration patterns
- [x] Map existing table features to DataTable component capabilities
- [x] Identify any gaps between current functionality and shared component features

### Phase 2: DataTable Integration (AC: 1, 4, 5, 7)
- [x] Replace custom table JSX with DataTable component import
- [x] Configure DataTable columns for date and count data
- [x] Migrate table data formatting logic to DataTable column definitions
- [x] Update TypeScript interfaces to work with DataTable expected props
- [x] Remove custom table CSS classes in favor of DataTable styling
- [x] Test data rendering and formatting with DataTable component

### Phase 3: Pagination Integration (AC: 2, 4, 6, 8)
- [x] Replace custom pagination controls with Pagination component
- [x] Integrate useEggPagination hook with Pagination component props
- [x] Configure responsive pagination behavior using Pagination variants
- [x] Migrate pagination state management to work with shared component
- [x] Remove custom pagination CSS and JavaScript logic
- [x] Verify Framer Motion animations work with new pagination component

### Phase 4: Animation and UX Preservation (AC: 4, 8)
- [x] Ensure table row animations are preserved with DataTable
- [x] Verify loading states work correctly with DataTable component
- [x] Test hover effects and interactive states with shared components
- [x] Confirm responsive breakpoints function correctly
- [x] Validate that all user interactions maintain existing behavior

### Phase 5: Code Cleanup and Optimization (AC: 5, 7)
- [x] Remove unused custom table styling from component
- [x] Clean up unused imports and dependencies
- [x] Update component TypeScript types to match shared component interfaces
- [x] Remove duplicate styling code that's now handled by shared components
- [x] Optimize component re-render behavior with shared component integration

### Phase 6: Testing and Validation (AC: 4, 6, 7)
- [x] Test component functionality across mobile, tablet, and desktop breakpoints
- [x] Verify form submission and data refresh work correctly with new table
- [x] Test pagination navigation and page size functionality
- [x] Validate TypeScript compilation with no errors
- [x] Confirm all existing user workflows remain functional
- [x] Test loading states and error handling scenarios

## Dev Notes

### Current Component Architecture Analysis
The EggCounter component is currently located at `src/components/EggCounter.tsx` and uses several well-organized patterns:
- **Form Management**: Already uses shared FormCard, FormGroup, DateInput, NumberInput, SubmitButton from `src/components/forms/`
- **Data Management**: Uses `useEggData` hook for data operations and `useEggPagination` hook for pagination logic
- **State Management**: Uses custom hooks `useFormState`, `useFormValidation`, `useTimeoutToggle` for clean state handling
- **UI Components**: Already uses StatCard component for metrics display

[Source: Analysis of `src/components/EggCounter.tsx` lines 1-328]

### Custom Table Implementation Details
The EggCounter contains a custom table implementation (lines 222-247) that should be replaced:
```typescript
<table className="min-w-max">
  <thead>
    <tr>
      <th className="px-6 py-4 text-left text-sm font-semibold text-gray-900 bg-gray-50/50">Date</th>
      <th className="px-6 py-4 text-left text-sm font-semibold text-gray-900 bg-gray-50/50">Count</th>
    </tr>
  </thead>
  <tbody className="divide-y divide-gray-100">
    {paginatedEntries.map((entry, index) => (/* custom row rendering */))}
  </tbody>
</table>
```

This custom implementation duplicates patterns that exist in the shared DataTable component.

[Source: `src/components/EggCounter.tsx` lines 222-247]

### Custom Pagination Implementation Details
The EggCounter contains custom pagination controls (lines 249-321) that duplicate shared component functionality:
- Mobile pagination buttons (lines 250-271)
- Desktop pagination with page numbers (lines 272-320)
- Page info display (lines 274-281)
- Custom navigation buttons and styling

This should be replaced with the Pagination component from `src/components/ui/navigation/`.

[Source: `src/components/EggCounter.tsx` lines 249-321]

### Available Shared Components for Integration

#### DataTable Component
Located at `src/components/ui/tables/DataTable.tsx` with the following capabilities:
- Configurable column definitions with custom rendering
- Built-in sorting functionality
- Loading state support
- Responsive design patterns
- TypeScript interfaces for type safety
- Integration with Framer Motion animations

**Props Interface:**
```typescript
interface DataTableProps<T> {
  data: T[];
  columns: Column<T>[];
  loading?: boolean;
  onSort?: (field: string, direction: 'asc' | 'desc') => void;
  sortField?: string;
  sortDirection?: 'asc' | 'desc';
  className?: string;
}
```

[Source: docs/architecture/shared-components-library.md#DataTable]

#### Pagination Component
Located at `src/components/ui/navigation/Pagination.tsx` with features:
- Current page and total pages management
- Configurable page number display
- First/last page navigation
- Responsive mobile/desktop variants
- TypeScript prop interfaces
- Integration with pagination hooks

**Props Interface:**
```typescript
interface PaginationProps {
  currentPage: number;
  totalPages: number;
  onPageChange: (page: number) => void;
  showFirstLast?: boolean;
  showPageNumbers?: number;
  className?: string;
}
```

[Source: docs/architecture/shared-components-library.md#Pagination]

### Integration with Existing Hooks
The component already uses well-structured custom hooks that will integrate seamlessly:
- **useEggPagination**: Provides `currentPage`, `totalPages`, `paginatedEntries`, `goToPage`, `nextPage`, `previousPage`
- **useEggData**: Provides data and loading states
- These hooks provide exactly the interface needed for the shared Pagination and DataTable components

[Source: `src/components/EggCounter.tsx` lines 24-38]

### Framer Motion Animation Preservation
Current animations that must be preserved:
- Container fade-in: `initial={{ opacity: 0 }} animate={{ opacity: 1 }}`
- Row stagger animations: `transition={{ delay: index * 0.05 }}`
- Loading state transitions with AnimatePresence
- Interactive hover states: `className="hover:bg-gray-50/50 transition-colors"`

The DataTable component supports custom row rendering which can maintain these animation patterns.

[Source: `src/components/EggCounter.tsx` lines 129, 234-237]

### Testing Infrastructure Requirements
From architecture documentation, testing must include:
- **Testing Framework**: Vitest with React Testing Library
- **Test Location**: `src/components/__tests__/EggCounter.test.tsx` already exists
- **Coverage Target**: 90%+ test coverage for refactored functionality
- **Testing Approach**: User-centric testing patterns

Additional testing required for integration:
- DataTable component integration tests
- Pagination component integration tests
- Responsive behavior validation
- Animation and interaction testing

[Source: docs/architecture/coding-standards.md#Testing Standards]

### File Structure and Import Patterns
Following established coding standards:
```typescript
// Import organization (existing pattern in component)
import React, { useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

// Shared UI components (to be added)
import { DataTable, Pagination } from '../components/ui';

// Existing shared components (already in use)
import { StatCard } from './ui';
import { FormCard, DateInput, NumberInput, SubmitButton } from './forms';
```

[Source: docs/architecture/coding-standards.md#Component Structure Standards]

### TypeScript Type Safety Considerations
The component maintains strict TypeScript usage:
- Current data types from `useEggData` hook return properly typed entries
- DataTable and Pagination components have comprehensive TypeScript interfaces
- No 'any' types should be introduced during refactoring
- All props and data flow must maintain type safety

[Source: Analysis of component imports and Epic 3 completion status in PRD]

## Testing

### Testing Standards Requirements
Based on architecture documentation requirements:
- **Testing Framework**: Vitest with React Testing Library
- **Test File Location**: Update existing `src/components/__tests__/EggCounter.test.tsx`
- **Testing Approach**: User-centric testing focusing on component behavior
- **Coverage Target**: Maintain 90%+ test coverage

[Source: docs/architecture/tech-stack.md#Vitest Testing Framework]

### Specific Testing Requirements for This Refactoring
1. **Integration Testing**: Verify DataTable and Pagination components work correctly with existing hooks
2. **Responsive Testing**: Ensure shared components maintain responsive behavior across breakpoints
3. **Animation Testing**: Verify Framer Motion animations continue to work with shared components
4. **User Workflow Testing**: Test complete user workflows (add egg entry, view table, navigate pages)
5. **Type Safety Testing**: Ensure TypeScript compilation passes with no errors

### Test Implementation Strategy
- **Unit Tests**: Test shared component integration with existing data and pagination hooks
- **Visual Testing**: Verify UI components render correctly and maintain existing styling
- **Interaction Tests**: Test pagination navigation, sorting, and form submission workflows
- **Regression Tests**: Ensure all existing functionality continues to work identically

### Test File Updates Required
The existing test file `src/components/__tests__/EggCounter.test.tsx` will need updates to:
- Test DataTable component rendering with egg entry data
- Test Pagination component integration with useEggPagination hook
- Verify responsive behavior with shared components
- Test animation preservation with new component structure

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-18 | 1.0 | Initial story creation for EggCounter refactoring with shared components | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-20250514

### Completion Notes
- ✅ Successfully refactored EggCounter component to use shared DataTable and Pagination components
- ✅ Replaced custom table implementation (lines 222-247) with DataTable component
- ✅ Replaced custom pagination controls (lines 249-321) with Pagination component  
- ✅ Maintained all existing functionality including Framer Motion animations, form handling, and responsive design
- ✅ Updated TypeScript types to work with shared component interfaces
- ✅ Cleaned up unused imports and dependencies
- ✅ Updated component tests to work with new shared component structure
- ✅ All tests passing (5/5) with proper mocking of shared components
- ✅ Fixed TypeScript lint error regarding 'any' type usage
- ✅ Preserved all user interactions and workflows

### File List
- Modified: `src/components/EggCounter.tsx` - Main component refactoring
- Modified: `src/components/__tests__/EggCounter.test.tsx` - Updated tests for shared components

### Change Log
- Replaced custom table JSX with DataTable component import
- Added TableColumn configuration for date and count data with proper TypeScript typing
- Replaced custom pagination controls with Pagination component integration
- Removed custom table CSS classes in favor of DataTable styling
- Updated component tests to mock shared components and validate integration
- Fixed TypeScript type safety by replacing `any` with proper interface types

---

*This story focuses on leveraging the comprehensive shared component library to eliminate code duplication in EggCounter while maintaining all existing functionality and user experience.*