# Story 1.1: User Profile Page

## Status
Ready

## Story
**As a** chicken keeper using the Chicken Manager application,
**I want** a dedicated user profile page where I can manage my account information, subscription, security settings, and yearly egg production goals,
**so that** I can maintain my account, track my subscription status, secure my data, and set meaningful production targets for my flock operation.

## Acceptance Criteria

1. **User Profile Information Management**
   - Display and allow editing of basic user information (name, email)  
   - Changes are saved to the database and reflected immediately in the UI
   - Validation prevents submission of invalid data (empty name, invalid email format)

2. **Subscription Management Display**
   - Show current subscription plan with clear visual indication
   - Provide upgrade/downgrade buttons or links for plan changes
   - Display subscription status and any relevant billing information

3. **Password Reset Functionality**
   - Provide a "Reset Password" button that triggers the password reset flow
   - Integration with Supabase Auth password reset functionality
   - User receives confirmation that password reset email has been sent

4. **Yearly Egg Production Goal Setting**
   - Allow user to set and update their yearly egg production goal
   - Goal is stored in user profile and used for analytics/progress tracking
   - Display current progress toward yearly goal if available

5. **Responsive Design & Navigation**
   - Page is fully responsive and works on mobile and desktop
   - Consistent with existing application design system (neumorphic styling)
   - Accessible via main navigation menu

## Tasks / Subtasks

- [ ] **Create User Profile Component** (AC: 1, 2, 3, 4, 5)
  - [ ] Create ProfilePage.tsx component in src/components/
  - [ ] Implement neumorphic card layout with sections for different features
  - [ ] Add to React Router routing configuration in App.tsx
  - [ ] Add profile page to main navigation menu

- [ ] **Implement Basic User Information Section** (AC: 1)
  - [ ] Create form fields for name and email editing
  - [ ] Add validation for required fields and email format
  - [ ] Implement save functionality using UserService.saveUserProfile()
  - [ ] Add success/error messaging for save operations

- [ ] **Implement Subscription Management Section** (AC: 2)
  - [ ] Display current subscription plan information
  - [ ] Add placeholder upgrade/downgrade buttons (future LemonSqueezy integration)
  - [ ] Style subscription status with appropriate visual indicators

- [ ] **Implement Password Reset Section** (AC: 3)
  - [ ] Add "Reset Password" button
  - [ ] Integrate with Supabase Auth resetPasswordForEmail() method
  - [ ] Add confirmation message after password reset email sent
  - [ ] Handle error cases (invalid email, network errors)

- [ ] **Implement Yearly Goal Setting Section** (AC: 4)
  - [ ] Add input field for yearly egg production goal
  - [ ] Save goal using UserService with proper validation
  - [ ] Display current progress if egg production data exists
  - [ ] Calculate and show percentage of yearly goal achieved

- [ ] **Testing Implementation** (AC: All)
  - [ ] Create ProfilePage.test.tsx with comprehensive test coverage
  - [ ] Test form validation and submission flows
  - [ ] Test password reset functionality
  - [ ] Test yearly goal setting and saving
  - [ ] Test responsive design at different screen sizes

## Dev Notes

### Architecture Context
Based on the current Chicken Manager architecture, this story should integrate with the existing systems:

**Authentication & User Management**: Uses Supabase Auth with JWT tokens, integrated through AuthContext.tsx [Source: architecture/tech-stack.md#authentication-authorization]

**API Service Integration**: Should use the unified API service layer with UserService for profile operations [Source: architecture/api-service-implementation.md#service-structure]

**Component Structure**: Follows established patterns with neumorphic design system and proper TypeScript interfaces [Source: architecture/coding-standards.md#component-structure-standards]

### Technical Implementation Details

**File Location**: Component should be created as `src/components/ProfilePage.tsx` based on established component organization patterns [Source: architecture/source-tree.md#frontend-structure]

**Styling Approach**: Use Tailwind CSS 4.x with neumorphic design tokens consistent with existing components like StatCard [Source: architecture/tech-stack.md#styling-design-system]

**Design System Compliance**: Follow BMad Brand Style Guide including glassmorphic card design (`.glass-card`), purple color palette (#4F46E5 primary), Fraunces typography, and established UI component patterns [Source: architecture/Brand-Style-Guide.md#ui-component-library-reference]

**Data Models**: User profile data should align with existing type definitions in `src/types/index.ts` for consistency [Source: architecture/source-tree.md#key-data-models]

**Authentication Integration**: Access user data through AuthContext, ensure all operations are authenticated [Source: architecture/source-tree.md#security-architecture]

**API Endpoints**: 
- Profile updates via UserService.saveUserProfile()
- Password reset via Supabase Auth resetPasswordForEmail()
- Goal setting through existing user preferences system
[Source: architecture/api-service-implementation.md#usage-examples]

**Navigation Integration**: Add new route to React Router DOM 7.5.1 configuration in App.tsx, add menu item to existing navigation components [Source: architecture/tech-stack.md#routing-navigation]

### Data Flow Pattern
1. ProfilePage loads user data from AuthContext
2. Form changes managed with local state (useState)
3. Save operations use UserService methods
4. Success/error states provide user feedback
5. Data refreshes maintain consistency across app

### Performance Considerations
- Form inputs use controlled components for immediate feedback
- Debounced saving for goal input to prevent excessive API calls
- Optimistic UI updates where appropriate
- Integration with existing 5-minute data cache pattern [Source: architecture/source-tree.md#performance-optimizations]

### Testing

**Test File Location**: `src/components/__tests__/ProfilePage.test.tsx` following established testing structure [Source: architecture/source-tree.md#testing-strategy]

**Testing Framework**: Vitest with React Testing Library and jsdom environment [Source: architecture/tech-stack.md#development-testing]

**Test Coverage Requirements**: 90%+ coverage matching project standards, including:
- Component rendering with different user states
- Form validation and submission
- Password reset flow
- Goal setting functionality
- Error handling scenarios
- Responsive design validation

**Mock Requirements**:
- Mock UserService methods using Vitest vi.mock()
- Mock Supabase Auth methods for password reset
- Mock AuthContext for different user states
- Use MSW for API request mocking if needed

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-14 | 1.0 | Initial story creation for user profile page | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*Results from QA Agent QA review of the completed story implementation*